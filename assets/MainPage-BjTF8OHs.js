import{r as s,U as b,j as n,c as F,B as g,L as Q,P as T,S as G,a as J,R as S}from"./index-A0RnPa27.js";const X="/TestTask/assets/productImg-BkGkeiLL.jpg",Y=({productId:e})=>{const r={action:"get_items",params:{ids:[`${e}`]}},[t,a]=s.useState({});return s.useEffect(()=>{b({url:"https://api.valantis.store:41000/",body:r}).then(i=>{a(i.result[0])})},[e]),n.jsxs("div",{className:F.product_card,children:[n.jsx("div",{className:F.product_card__img,children:n.jsx("img",{src:X,alt:""})}),n.jsx("h2",{children:t.product}),n.jsxs("p",{children:[t.price," Рублей"]}),n.jsx("p",{children:t.brand===null?"Бренд неизвестен":t.brand}),n.jsx(g,{children:n.jsx(Q,{to:`/product/${e}`,children:"Подробнее"})})]})},Z=({body:e,productsPerPage:r,filtered:t,searchQuery:a,isFilteredByPriceOrBrand:i,setFilteredArray:o})=>{const{productsArray:j,setProductsArray:f}=s.useContext(T),{currentPage:l}=s.useContext(G),[p,m]=s.useState([]),y=l*r,v=y-r,_=j.slice(v,y),h=s.useMemo(()=>({action:"filter",params:{product:`${a.toLowerCase()}`}}),[a]);return s.useEffect(()=>{m([...p,l])},[l]),s.useEffect(()=>{i||(t?b({url:"https://api.valantis.store:41000/",body:h}).then(u=>f(u.result)):p.includes(l)||b({url:"https://api.valantis.store:41000/",body:e}).then(u=>f([...j,u.result].flat())))},[t,e,h]),s.useEffect(()=>{i&&b({url:"https://api.valantis.store:41000/",body:h}).then(u=>o(u.result))},[i,t,h]),n.jsx(n.Fragment,{children:n.jsx("div",{className:J.ProductsList,children:_.map(u=>n.jsx(Y,{productId:u},u))})})},ee="_mainpage_j6ngo_1",te="_mainpage__openBtn_j6ngo_17",re="_mainpage__pagination_j6ngo_27",ne="_mainpage__options_j6ngo_35",A={mainpage:ee,mainpage__openBtn:te,mainpage__pagination:re,mainpage__options:ne},W=({...e})=>n.jsx("input",{...e});var R={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$=S.createContext&&S.createContext(R),ae=["attr","size","title"];function se(e,r){if(e==null)return{};var t=ie(e,r),a,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)a=o[i],!(r.indexOf(a)>=0)&&Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}function ie(e,r){if(e==null)return{};var t={},a=Object.keys(e),i,o;for(o=0;o<a.length;o++)i=a[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}function M(){return M=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},M.apply(this,arguments)}function V(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,a)}return t}function I(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?V(Object(t),!0).forEach(function(a){ce(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):V(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function ce(e,r,t){return r=le(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function le(e){var r=oe(e,"string");return typeof r=="symbol"?r:String(r)}function oe(e,r){if(typeof e!="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var a=t.call(e,r||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function U(e){return e&&e.map((r,t)=>S.createElement(r.tag,I({key:t},r.attr),U(r.child)))}function D(e){return r=>S.createElement(ue,M({attr:I({},e.attr)},r),U(e.child))}function ue(e){var r=t=>{var{attr:a,size:i,title:o}=e,j=se(e,ae),f=i||t.size||"1em",l;return t.className&&(l=t.className),e.className&&(l=(l?l+" ":"")+e.className),S.createElement("svg",M({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,j,{className:l,style:I(I({color:e.color||t.color},t.style),e.style),height:f,width:f,xmlns:"http://www.w3.org/2000/svg"}),o&&S.createElement("title",null,o),e.children)};return $!==void 0?S.createElement($.Consumer,null,t=>r(t)):r(R)}function de(e){return D({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M337.509 305.372h-17.501l-6.571-5.486c20.791-25.232 33.922-57.054 33.922-93.257C347.358 127.632 283.896 64 205.135 64 127.452 64 64 127.632 64 206.629s63.452 142.628 142.225 142.628c35.011 0 67.831-13.167 92.991-34.008l6.561 5.487v17.551L415.18 448 448 415.086 337.509 305.372zm-131.284 0c-54.702 0-98.463-43.887-98.463-98.743 0-54.858 43.761-98.742 98.463-98.742 54.7 0 98.462 43.884 98.462 98.742 0 54.856-43.762 98.743-98.462 98.743z"},child:[]}]})(e)}const he="_navbar_135ir_1",fe="_navbar_active_135ir_21",ge="_navbar__content_135ir_27",pe="_navbar__contentClose__btn_135ir_43",E={navbar:he,navbar_active:fe,navbar__content:ge,navbar__contentClose__btn:pe};function me(e){return D({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"},child:[]}]})(e)}function ve(e,r){const[t,a]=s.useState(e);return s.useEffect(()=>{const i=setTimeout(()=>{a(e)},r);return()=>{clearTimeout(i)}},[e]),t}const _e=({arrayToSort:e})=>{const r=[];for(let t of new Set(e))r.push(t);return r};function be(e){return Number.isInteger(e)?+(e+".0"):Number(e)}const je=({active:e,setActive:r,setIsFilteredByPriceOrBrand:t,setArrFilteredByPriceOtBrand:a})=>{const{productsArray:i,setProductsArray:o}=s.useContext(T),[j,f]=s.useState([]),[l,p]=s.useState(""),[m,y]=s.useState([]),[v,_]=s.useState(0),[h,u]=s.useState([]),[B,x]=s.useState([]),[N,C]=s.useState(!1),L=ve(v,1e3),d={action:"get_fields",params:{field:"brand"}},w=_e({arrayToSort:j});s.useEffect(()=>{b({url:"https://api.valantis.store:41000/",body:d}).then(c=>f(c.result))},[]);const z={action:"filter",params:{brand:`${l}`}};s.useEffect(()=>{b({url:"https://api.valantis.store:41000/",body:z}).then(c=>y(c.result))},[l]);const O={action:"filter",params:{price:be(v)}};s.useEffect(()=>{b({url:"https://api.valantis.store:41000/",body:O}).then(c=>u(c.result))},[L]),s.useEffect(()=>{C(!0);let c=[];if(v>0&&l.length>0){let P=m.length<h.length?m:h,H=m.length<h.length?h:m;for(let k=0;k<P.length;k++)H.includes(P[k])&&c.push(P[k])}else v>0&&l.length===0?h.forEach(P=>c.push(P)):l.length>0&&v==0&&m.forEach(P=>c.push(P));x(c)},[m,h]);function q(){if(C(!1),B.length<=0){alert("Ничего согласно вашему запросу найдено небыло");return}t(!0),o(B),a(B)}function K(){t(!1),a([]),_(0),p(""),b({url:"https://api.valantis.store:41000/",body:{action:"get_ids",params:{offset:0,limit:50}}}).then(c=>o(c.result))}return n.jsx("div",{className:e?E.navbar+" "+E.navbar_active:E.navbar,children:e&&n.jsxs("div",{className:E.navbar__content,children:[n.jsxs("label",{children:["Отсортировать по цене",n.jsx(W,{type:"number",onChange:c=>_(c.target.value),value:v})]}),n.jsxs("label",{children:["Отсортировать по бренду ",n.jsxs("select",{onChange:c=>p(c.target.value),value:l,children:[n.jsx("option",{value:"def",defaultValue:!0,children:"Не указано"}),w.map(c=>n.jsx("option",{disabled:c==null,value:c,children:c??"Бренд отсутствует"},c))]})]}),n.jsx("div",{className:E.navbar__contentClose__btn,children:n.jsx(g,{onClick:()=>r(!1),children:n.jsx(me,{})})}),n.jsx(g,{onClick:q,className:`${N?"button-active":""}`,children:"Применить"}),n.jsx(g,{onClick:K,children:"Убрать все фильтры"})]})})};function ye(e){return D({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"48",d:"M88 152h336M88 256h336M88 360h336"},child:[]}]})(e)}const Pe=()=>{const{productsArray:e,setProductsArray:r}=s.useContext(T),{currentPage:t,setCurrentPage:a,productsPerPage:i}=s.useContext(G),[o,j]=s.useState(!1),[f,l]=s.useState(!1),[p,m]=s.useState(""),[y,v]=s.useState(""),[_,h]=s.useState(!1),[u,B]=s.useState([]),[x,N]=s.useState([]),C=s.useMemo(()=>({action:"get_ids",params:{offset:t,limit:i}}),[t,i]);s.useEffect(()=>{p.length===0?(l(!1),a(1),_?b({url:"https://api.valantis.store:41000/",body:C}).then(d=>N(d.result)):b({url:"https://api.valantis.store:41000/",body:C}).then(d=>r(d.result))):l(!0)},[p]),s.useEffect(()=>{if(_&&f){let d=[],w=u.length<x.length?u:x,z=u.length<x.length?x:u;for(let O=0;O<w.length;O++)z.includes(w[O])&&d.push(w[O]);r(d)}else _&&r(u)},[_,f,u,x]);const L=()=>{m(y)};return n.jsxs("main",{className:A.mainpage,children:[n.jsx("div",{className:A.mainpage__openBtn,children:!o&&n.jsx(g,{onClick:()=>j(!0),children:n.jsx(ye,{})})}),n.jsx(je,{setArrFilteredByPriceOtBrand:B,setIsFilteredByPriceOrBrand:h,active:o,setActive:j}),n.jsxs("div",{className:A.mainpage__options,children:[n.jsxs("div",{className:A.mainpage__pagination,children:[t!==1?n.jsx(g,{onClick:()=>a(d=>d-1),children:"Назад"}):n.jsx(n.Fragment,{}),t!==1?n.jsx(g,{onClick:()=>a(t-1),children:t-1}):n.jsx(n.Fragment,{}),n.jsx(g,{onClick:()=>a(t),disabled:!0,className:"button-active",children:t}),e.length<i?n.jsx(n.Fragment,{}):n.jsx(g,{onClick:()=>a(t+1),children:t+1}),e.length<i?n.jsx(n.Fragment,{}):n.jsx(g,{onClick:()=>a(d=>d+1),children:"Вперёд"})]}),n.jsxs("div",{children:[n.jsx(W,{value:y,onChange:d=>v(d.target.value),placeholder:"Поиск по названию"}),n.jsx(g,{className:y!==p?"button-active":null,onClick:L,children:n.jsx(de,{})})]})]}),n.jsx("h2",{children:"Наши продукты"}),n.jsx(Z,{setFilteredArray:N,isFilteredByPriceOrBrand:_,searchQuery:p,productsPerPage:i,body:C,filtered:f})]})};export{Pe as default};
